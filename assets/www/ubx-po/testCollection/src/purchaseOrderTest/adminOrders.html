<html xmlns:javascript="http://www.w3.org/2002/xforms#inline" xmlns:xsi="http://www.w3.org/2001/XMLSchema-Instance" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:ev="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns="http://www.w3.org/1999/xhtml"><head><meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"/><meta name="AUTHOR" content="Erik A. Johnson"/><title>Purchase Order Application XForm</title><script src="../../src/ubiquity-loader.js" type="text/javascript">/**/</script><script src="../format.js" type="text/javascript">/**/</script><link href="./style/mainStyle.css" rel="stylesheet"/><link href="./style/gen_default.css" rel="stylesheet"/></head><body class="yui-skin-sam"><xforms:model id="model">  
           <!-- Main inventory listing retreived from the eXist database  --><xforms:instance id="Orders" src="http://localhost:8080/exist/rest/db/testCollection/ordersList.xml"/>
           <!-- Main inventory listing retreived from the eXist database  --><xforms:instance id="inventoryList" src="http://localhost:8080/exist/rest/db/testCollection/testInventorylist.xml"/><xforms:instance id="Prototype" src="http://localhost:8080/exist/rest/db/testCollection/orderPrototype.xml"/><xforms:submission id="updateOrders" method="put" includenamespaceprefixes="" action="http://localhost:8080/exist/rest/db/testCollection/ordersList.xml"><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')!='validation-error'">Unable to submit. Please try again later.</xforms:message><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')='validation-error'">Some of the data on this form is invalid. Please correct errors and try again.</xforms:message></xforms:submission><xforms:submission id="refreshOrdersCache" method="get" includenamespaceprefixes="" action="http://localhost:8080/exist/rest/db/testCollection/ordersList.xml" replace="instance" instance="Orders"><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')!='validation-error'">Refresh failed, server un-available</xforms:message><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')='validation-error'">Some of the data on this form is invalid. Please correct errors and try again.</xforms:message></xforms:submission>
           
            <!-- The total is just the sum of the subtotal and the tax; any time
                  those change, the total is automatically updated --><xforms:bind nodeset="instance('Orders')/order/total" calculate="../subtotal + ../tax"/>
           	                 
           <!-- The tax is just the subtotal times the tax rate --><xforms:bind nodeset="instance('Orders')/order/tax" calculate="../subtotal * 0.07"/>
           
           <!-- The node set feature of XPath is used to get all the line total 
                  elements and set a calculation for each one.  A line total is
                  just the unit cost times the quantity.  Any time a new row is 
                  inserted, this declaration automatically creates a new line total
                  calculation for it.  An update of unit cost or quantity on any row 
                  automatically updates the line total of that row, which then causes
                  the subtotal, tax and total to be updated automatically.  Even though
                  those calculations are declared before this one, XForms reorders the 
                  calculations so that they run in the order that makes sense. --><xforms:bind nodeset="instance('Orders')/order/productsList/product/lineTotal" calculate="../cost * ../quantity"/>
             
           
           <!-- The subtotal is the sum of all the line totals.  Any time a row is
                  inserted, deleted or changed, the subtotal is automatically updated.
                  The calculate uses the 'node set' feature of XPath to get however
                  many line total elements exist for the summation. --><xforms:bind nodeset="instance('Orders')/order/subtotal" calculate="sum(../productsList/product/lineTotal)"/>
           

           <!-- Once a purchase item is created, the user must specify a quantity. --><xforms:bind nodeset="instance('Orders')/order/productsList/product/quantity" type="xsd:positiveInteger"/><xforms:instance id="removeOrder"><orders><orderID>0</orderID></orders></xforms:instance><xforms:submission id="processOrders" method="post" includenamespaceprefixes="" action="http://localhost:8080/exist/rest/db/testCollection/updateHistory.xql" instance="removeOrder"><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')!='validation-error'">Refresh failed, server un-available</xforms:message><xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')='validation-error'">Some of the data on this form is invalid. Please correct errors and try again.</xforms:message></xforms:submission></xforms:model><div id="mainContainer"><div id="headerContainer"/> <!-- header div--><div id="mainContentArea"><div id="leftNavigation"><ul><li><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Shopping Cart.png"/><xforms:label>Orders</xforms:label></xforms:trigger></li><li><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Check.png"/><xforms:label>Processed</xforms:label><xforms:load ev:event="DOMActivate" resource="adminProcessed.html"/></xforms:trigger></li><li><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Door.png"/><xforms:label>Inventory</xforms:label><xforms:load ev:event="DOMActivate" resource="adminInventory.html"/></xforms:trigger></li><li><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/logout.png"/><xforms:label>Logout</xforms:label><xforms:load ev:event="DOMActivate" resource="purchaseOrderMain.html"/></xforms:trigger></li></ul></div><div id="mainForm"><br/><h3>Current Orders</h3><hr class="rule"/><br/><br/><xforms:repeat instance="Orders" nodeset="/ordersList/order" id="ordersTable"><xforms:output><img class="buttonImage" src="../pngIcons/User.png"/><xforms:label ref="customerInfo/customer/customerName"/></xforms:output><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Check.png"/><xforms:label>Process Order</xforms:label><xforms:action ev:event="DOMActivate"><xforms:setvalue ref="instance('removeOrder')/orderID" value="instance('Order')/order/@orderID"/><xforms:send submission="processOrders"/>
			<!-- Delete the currently indexed item --><xforms:delete nodeset="../order" at="index('ordersTable')"/> 
			 <!-- Put the focus to the indexed item of the order table --><xforms:setfocus control="ordersTable"/></xforms:action></xforms:trigger><xforms:repeat nodeset="productsList/product" id="productListings"><hr/><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Delete3.png"/><xforms:label/><xforms:action ev:event="DOMActivate">
			       <!-- Delete the currently indexed item --><xforms:delete nodeset="../product" at="index('productListings')"/> 
			       <!-- Put the focus to the indexed item of the order table --><xforms:setfocus control="productListings"/></xforms:action></xforms:trigger>
		
		
		
		
		
	      <!--<xforms:input ref="productName">
		<xforms:label>Name:</xforms:label>
	      </xforms:input>--><xforms:select1 ref="@productID" appearance="minimal"><xforms:label>Product:</xforms:label><xforms:itemset nodeset="instance('inventoryList')/product"><xforms:label><xforms:output ref="productName"/><xforms:output ref="image" mediatype="image/*"/></xforms:label><xforms:value ref="@productID"/></xforms:itemset><xforms:action ev:event="xforms-value-changed">
					<!-- in here we need to set the value of the purchase currently selected in the model
					this change will then be reflected on the UI. 
					<xforms:setvalue ref="../productName"
									value="instance('inventoryList')/product[@productID = current()]/productName">	         
					 </xforms:setvalue>
					
					--><xforms:setvalue ref="../cost" value="instance('inventoryList')/product[@productID = current()/../@productID]/cost"/></xforms:action></xforms:select1><xforms:input class="cost" ref="cost"><xforms:label>Cost:</xforms:label></xforms:input><xforms:input class="quantity" ref="quantity"><xforms:label>Quantitiy:</xforms:label><xforms:hint>You can change to customers quantity.</xforms:hint><xforms:alert>This must be a positive whole number value.</xforms:alert></xforms:input></xforms:repeat><xforms:trigger class="addOrderEntry" appearance="xf:image"><img class="buttonImage" src="../pngIcons/Add2.png"/><xforms:label>Add Item</xforms:label><xforms:action ev:event="DOMActivate">
					      <!-- Insert a new item after the currently indexed item
				(the last focused item before this trigger was activated) --><xforms:insert nodeset="productsList/product" at="index('productListings')" position="after" origin="instance('Prototype')/product"/>
			
			   <!-- Send the focus to the new item in the order table --><xforms:setfocus control="productListings"/></xforms:action></xforms:trigger><hr/><xforms:output ref="subTotal" class="table_summary regular" value="javascript:currency(number())"><xforms:label>Subtotal:</xforms:label></xforms:output><xforms:output ref="tax" class="table_summary regular" value="javascript:currency(number())"><xforms:label>Tax:</xforms:label></xforms:output><xforms:output ref="total" class="table_summary regular" value="javascript:currency(number())"><xforms:label>Total:</xforms:label></xforms:output></xforms:repeat><xforms:submit submission="updateOrders" appearance="xf:image"><img class="buttonImage" src="../pngIcons/save2.png"/><xforms:label>Save</xforms:label></xforms:submit><xforms:trigger appearance="xf:image"><img class="buttonImage" src="../pngIcons/Add2.png"/><xforms:label>Add Order</xforms:label><xforms:action ev:event="DOMActivate">
        
           <!-- Insert a new item after the currently indexed item
                (the last focused item before this trigger was activated) --><xforms:insert context="/ordersList" nodeset="order" at="index('ordersTable')" position="after" origin="instance('Prototype')/order"/>
        
           <!-- Send the focus to the new item in the order table --><xforms:setfocus control="ordersTable"/></xforms:action></xforms:trigger><xforms:submit submission="refreshOrdersCache" appearance="xf:image"><xforms:hint>Refresh the data from Database, you will lose any unsaved data.</xforms:hint><img class="buttonImage" src="../pngIcons/Refresh.png"/><xforms:label>Refresh</xforms:label></xforms:submit></div><!-- mainForm--></div><!-- main content area--><div id="footerContainer"/> <!-- footer div--></div> <!--Main container div--></body></html>