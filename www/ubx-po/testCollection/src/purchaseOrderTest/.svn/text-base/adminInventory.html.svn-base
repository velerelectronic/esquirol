<?xml version="1.0"?>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ev="http://www.w3.org/2001/xml-events" 
      xmlns:xforms="http://www.w3.org/2002/xforms" 
      xmlns:xsd="http://www.w3.org/2001/XMLSchema"
      xmlns:xsi="http://www.w3.org/2001/XMLSchema-Instance"
	  xmlns:javascript="http://www.w3.org/2002/xforms#inline">
 <head>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type" />
    <meta name="AUTHOR" content="Erik A. Johnson" />
    <title>Purchase Order Application XForm</title>    
    <script src="../../src/ubiquity-loader.js" type="text/javascript">/**/</script>

    <script src="../format.js" type="text/javascript">/**/</script>
	<link href="./style/mainStyle.css" rel="stylesheet"></link>
	<link href="./style/gen_default.css" rel="stylesheet"></link>
	
  </head>
  <body class="yui-skin-sam">
       <xforms:model id="model">  
           <!-- Main inventory listing retreived from the eXist database  -->
           <xforms:instance id='Inventory' src="http://localhost:8080/exist/rest/db/testCollection/testInventorylist.xml"></xforms:instance>
           
           <xforms:instance id='Prototype' src="http://localhost:8080/exist/rest/db/testCollection/orderPrototype.xml"></xforms:instance>
           
           <xforms:submission id="updateInventory" 
                              method="put" 
                              includenamespaceprefixes=""
                              action="http://localhost:8080/exist/rest/db/testCollection/testInventorylist.xml">
                <xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')!='validation-error'">Unable to submit. Please try again later.</xforms:message>
                <xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')='validation-error'">Some of the data on this form is invalid. Please correct errors and try again.</xforms:message>
           </xforms:submission>
           
             <xforms:submission id="refreshInventoryCache" 
			     method="get" 
			     includenamespaceprefixes=""
			     action="http://localhost:8080/exist/rest/db/testCollection/testInventorylist.xml" 
			     replace="instance" instance="Inventory">
                <xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')!='validation-error'">Refresh failed, server un-available</xforms:message>
                <xforms:message ev:event="xforms-submit-error" level="modal" if="event('error-type')='validation-error'">Some of the data on this form is invalid. Please correct errors and try again.</xforms:message>  
            </xforms:submission>

           
           
           
           <bind nodeset="/productInventory/product/image" readonly="false()"/>
           
       </xforms:model>

<div id="mainContainer">

<div id="headerContainer">
  
 
 </div> <!-- header div-->
 
 <div id="mainContentArea">
	 <div id="leftNavigation">
	 <ul>
	 <li>
	 <xforms:trigger  appearance="xf:image">
	 	<img class="buttonImage" src="../pngIcons/Shopping Cart.png" />
	 	<xforms:label>Orders</xforms:label>
	 	<xforms:load ev:event="DOMActivate" resource="adminOrders.html"/>
        </xforms:trigger>
      </li>
         <li>
	 <xforms:trigger appearance="xf:image">
	 	<img class="buttonImage" src="../pngIcons/Check.png" />
	 	<xforms:label>Processed</xforms:label>
	 	<xforms:load ev:event="DOMActivate" resource="adminProcessed.html"/>
	 </xforms:trigger>
      </li>
      <li>
    
    <xforms:trigger appearance="xf:image">
    	<img class="buttonImage" src="../pngIcons/Door.png" />
        <xforms:label>Inventory</xforms:label>
         </xforms:trigger>
      </li>
      <li>
   
    <xforms:trigger appearance="xf:image">
    	<img class="buttonImage" src="../pngIcons/logout.png" />
        <xforms:label>Logout</xforms:label>
        <xforms:load ev:event="DOMActivate" resource="purchaseOrderMain.html"/>
    </xforms:trigger>
    </li>
    </ul>
		
	</div>
 
 <div id="mainForm">
 <br/>
 <h3>Inventory Listings</h3>
 <hr class="rule"/>
 <br/>
 <br/>
 
 
 
  
    
    
 
         <xforms:repeat nodeset="/productInventory/product" id="inventoryTable">
         	 
         	<xforms:trigger appearance="xf:image">
         		<xforms:hint>Removes this item from the model</xforms:hint>
			<img class="buttonImage" src="../pngIcons/Delete3.png" />
			<xforms:action ev:event="DOMActivate">
			       <!-- Delete the currently indexed item -->
			       <xforms:delete nodeset="../product" at="index('inventoryTable')"></xforms:delete>
			
			       <!-- Insert a blank item if the last one was just deleted -->
			       <xforms:insert context="order" origin="instance('Prototype')/product" 
					      if="count(/productInventory/product)=0"></xforms:insert>
			       
			       <!-- Put the focus to the indexed item of the order table -->
			       <xforms:setfocus control="inventoryTable"></xforms:setfocus>
       
			</xforms:action>
		</xforms:trigger>
			 <xforms:input class="item" ref="productName">
			 <xforms:hint>Item name you wish customer to see</xforms:hint>
			      	<xforms:label >Name:</xforms:label>
			      </xforms:input>
			      <xforms:input  class="cost" ref="cost">
			      	<xforms:label>Cost:</xforms:label>
			      	<xforms:hint>Cost in dollars</xforms:hint>
			      </xforms:input>
			      <xforms:input class="quantity" ref="quantity">
			      	<xforms:label>Quantitiy:</xforms:label>
			      	<xforms:hint>Positive quantity of items in stock</xforms:hint>
			      </xforms:input>
			      <xforms:trigger appearance="xf:image" >
			      		<xforms:output class="image"
			      			value="concat('&lt;img src=', image, '>')"
			      		mediatype="text/html"></xforms:output>
			      		
			      	<xforms:action ev:event="DOMActivate">
				
				
				</xforms:action> 	
			      		
			      </xforms:trigger>
			     
			      
		<br/>
	</xforms:repeat>
	
	
<xforms:submit submission="updateInventory" appearance="xf:image">
	<xforms:hint>Save changes to the Inventory database</xforms:hint>
		<img class="buttonImage" src="../pngIcons/save2.png" />
        <xforms:label>Save</xforms:label>
        <xforms:message  ev:event="DOMActivate" level="modal">
        	The database is now updated.
        </xforms:message>
    </xforms:submit>
    
    <xforms:trigger appearance="xf:image">
    	<xforms:hint>Add a new item to the inventory</xforms:hint>
    	<img class="buttonImage" src="../pngIcons/Add.png" />
        <xforms:label>Add</xforms:label>
        <xforms:action ev:event="DOMActivate">
        
           <!-- Insert a new item after the currently indexed item
                (the last focused item before this trigger was activated) -->
           <xforms:insert context="../productInventory" nodeset="product" at="count(/productInventory/product)" 
                          position="after" origin="instance('Prototype')/product"></xforms:insert>
        
           <!-- Send the focus to the new item in the order table -->
           <xforms:setfocus control="inventoryTable"></xforms:setfocus>
        
        </xforms:action> 
    </xforms:trigger>
    <xforms:submit submission="refreshInventoryCache" appearance="xf:image">
	<xforms:hint>Refresh the data from Inventory, you will lose any unsaved data.</xforms:hint>
		<img class="buttonImage" src="../pngIcons/Refresh.png" />
        <xforms:label>Refresh</xforms:label>
    </xforms:submit>
    <hr class="rule"/>
  
    </div><!-- mainForm-->
    
    
    </div><!-- main content area-->
<div id="footerContainer">
</div> <!-- footer div-->
   
</div> <!--Main container div-->
    

    
   </body>
</html>
